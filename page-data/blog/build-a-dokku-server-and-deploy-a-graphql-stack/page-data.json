{
    "componentChunkName": "component---src-templates-blog-post-tsx",
    "path": "/blog/build-a-dokku-server-and-deploy-a-graphql-stack/",
    "result": {"data":{"site":{"siteMetadata":{"title":"jordan rhea","siteUrl":"https://jordanrhea.com"}},"markdownRemark":{"id":"35d8b9a0-9af9-5b8a-8d6b-299e23476c10","excerpt":"The new Wes Bos course is called “Advanced React and GraphQL” and I can’t leave out a shout out to how much I enjoyed going through the course. I even went back…","html":"<p>The new Wes Bos course is called “Advanced React and GraphQL” and I can’t leave out a shout out to how much I enjoyed going through the course. I even went back and did it a second time to reinforce what I learned, and then took some of the things from his NodeJS course and added that to my app.</p>\n<p>The only thing I didn’t like about the course were the deployment steps. I wanted to create a way to house all 3 components (prisma server, graphql-yoga server, and the next.js frontend) all in the same place. The cheapest solution I could find: <strong>Dokku</strong>!</p>\n<p>I am going to walk through the steps I took to get everything set up. The attached video hits all of the points and shows a few of the goofs I made along the way. I am using <a href=\"https://m.do.co/c/80d1e1920b23\">Digital Ocean to host my Dokku server. You can use my referral link to help me out!</a></p>\n<h3>Setup your DNS servers</h3>\n<p>You need to take a visit to your domain registrar and change your DNS servers to the Digial Ocean nameservers:</p>\n<ul>\n<li>ns1.digitalocean.com</li>\n<li>ns2.digitalocean.com</li>\n<li>ns3.digitalocean.com</li>\n</ul>\n<h3>Digital Ocean</h3>\n<p>Once you have done that it takes a little while for the DNS servers to propogate, but you can go ahead and start the 1-click droplet creation.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/718d4c30056e9c346d4936670b190989/85e74/digital-ocean.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.67088607594937%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXElEQVQoz12SCY7cMAwE5///TJCJbx2UqKsCyp7FbgwQlmx1sUnqlRWyDmqtqOp8H6cgorRa596eMcYMLBhf+//j9T6Fy0eKKr33KTbGJYXTB1QzKSVqLbQGMQ+WUMk5TwMGb31MU7Z+/XULl7/Q/ADHIOVBq42S04SZ2LKXOkjaiJpI8vneJ9A0E3i6Ax/8zGbAWwjnvrFtb2ptiMh0mrWjlqgJOd3Oe2/070AvFUm3fcto0NrgvR78/vPm2HfWdSWGQOsgcbD9qjPBp+cG1PIAt/0ghEgp5XFoLiBdF2FbCDHivacUpXbIUojLjpYyDVhv+/ceGtAEltGgE1hAJZKiQ9WG0eZha0XKheBXUsrkWXK/S/4AQ+yI3PZbux2WMoipEUTRZyA2rNoGURrLHr5Ktn8/pnyKZz/26dKabAeCDCQPnAs4dz138RY56Swu4p3DOUdrdV4nH2/gP7oswDfHGcThAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Dokku 1-click install\"\n        title=\"Dokku 1-click install\"\n        src=\"/static/718d4c30056e9c346d4936670b190989/f058b/digital-ocean.png\"\n        srcset=\"/static/718d4c30056e9c346d4936670b190989/c26ae/digital-ocean.png 158w,\n/static/718d4c30056e9c346d4936670b190989/6bdcf/digital-ocean.png 315w,\n/static/718d4c30056e9c346d4936670b190989/f058b/digital-ocean.png 630w,\n/static/718d4c30056e9c346d4936670b190989/40601/digital-ocean.png 945w,\n/static/718d4c30056e9c346d4936670b190989/78612/digital-ocean.png 1260w,\n/static/718d4c30056e9c346d4936670b190989/85e74/digital-ocean.png 1436w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>The rest of the settings are pretty straightforward. If you want to set up an ssh key you will have to follow the steps provided on Digital Ocean. It is different on different systems!</p>\n<p>When the droplet is done building, just take a visit to the domain and make sure that the you have virtual naming selected. This allows each container to take the corresponding subdomain.</p>\n<h3>Deployment time</h3>\n<p>I followed the steps provided directly in the <a href=\"https://www.prisma.io/tutorials/deploy-prisma-to-dokku-ct15\">Prisma documentation</a>. If you are interested in using Let’s Encrypt to provision SSL certificates for your server, you can find examples of how to do that in my video.</p>\n<h3>Prisma</h3>\n<p>Now that you have a Prisma server, you need to create the service for your yoga server.</p>\n<p>Ssh back into your Dokku server and create a container called <code class=\"language-text\">yoga</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># how to create a container</span>\ndokku apps:create yoga\n\n<span class=\"token comment\"># how to add environment variables</span>\ndokku config:set yoga <span class=\"token assign-left variable\">ENV_VARIABLE_NAME</span><span class=\"token operator\">=</span><span class=\"token string\">\"ENV VARIABLE STRING\"</span></code></pre></div>\n<h3>Yoga</h3>\n<p>Add your new prisma server to the prisma dashboard</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/385c18f77e48d4a376e6feca16e3b3f5/4cdf7/prisma-dashboard.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.93670886075949%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABN0lEQVQoz12SuU4EMQyG5/173oCeigoKOiokqEGi4JI4dmcncZzL+ZE9ye5AJMuJ8883PjK11rA1kQYfGByT+dePTzgf7Dw7j5RL1wmkNWyXnqeDD/hvsyfMjszvFw8XGMQRnqOBOWXElO189X6Pi5db3H09gShh2jvCfzvCzAeDqQVeYQbMBY4Z5883OHu8xPXbA5xjTLIptYrYPgTG925GKdUy2s2LleMpYHFkmvngcFj8qdzc8LN4TKUU5FKsJ2PVKqi1rkIRu29oyHXVrpqKnAukiSUSUsJOgRpUU8gYjO5LrcfmG7B1YB/KAI7qtA0GTDlDrfYMh3ibYUrZ4mkD1HbEHv8D1L/r5bZsy6p/OExXFtWWo2bE1ccBdMQYps8gxGQTXeg0XepxfT6qG5oRJ70jNuAv1fm91e/dv7MAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Prisma Dashboard\"\n        title=\"Prisma Dashboard\"\n        src=\"/static/385c18f77e48d4a376e6feca16e3b3f5/f058b/prisma-dashboard.png\"\n        srcset=\"/static/385c18f77e48d4a376e6feca16e3b3f5/c26ae/prisma-dashboard.png 158w,\n/static/385c18f77e48d4a376e6feca16e3b3f5/6bdcf/prisma-dashboard.png 315w,\n/static/385c18f77e48d4a376e6feca16e3b3f5/f058b/prisma-dashboard.png 630w,\n/static/385c18f77e48d4a376e6feca16e3b3f5/40601/prisma-dashboard.png 945w,\n/static/385c18f77e48d4a376e6feca16e3b3f5/4cdf7/prisma-dashboard.png 995w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>Deploy your Front End container</h3>\n<p>First, <code class=\"language-text\">ssh</code> back into your Dokku server.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">dokku apps:create example.com</code></pre></div>\n<p>This will put your frontend on the root of your domain. You could also tell it to point <a href=\"http://www.example.com\">www.example.com</a> to your root also, but that is up to you. Before you push that up to you the server you need to create 2 files in the root of your front-end project.</p>\n<p>app.json</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"dokku\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"predeploy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"npm run build\"</span>\n      <span class=\"token comment\">// OR if you use yarn</span>\n      <span class=\"token comment\">//\"predeploy\": \"yarn build\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Procfile</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">web: <span class=\"token function\">npm</span> start -- --port <span class=\"token variable\">$PORT</span>\n<span class=\"token comment\"># OR if you use yarn</span>\n<span class=\"token comment\"># web: yarn start --port $PORT</span></code></pre></div>\n<p>Then just create the <code class=\"language-text\">git remote add dokku dokku@server:CONTAINERNAME</code> and push your project.</p>\n<h3>SSL Certificates</h3>\n<p>If you watch my video you see that I am using a <a href=\"https://github.com/dokku/dokku-letsencrypt\">Dokku plugin for Let’s Encrypt</a> to provision SSL certificates. It is super simple to do.</p>\n<p>Just install the plugin with <code class=\"language-text\">sudo dokku plugin:install https://github.com/dokku/dokku-letsencrypt</code>. Then set a global email address with <code class=\"language-text\">dokku config:set --global DOKKU_LETSENCRYPT_EMAIL=your@email.com</code></p>\n<p>This gives you access to run <code class=\"language-text\">dokku letsencrypt CONTAINER</code> on any of your containers to provide them with HTTPS.</p>\n<h3>Wrap-up</h3>\n<p>I know I missed a lot of steps in my write up, but the video is much more comprehensive. Let me know what I missed in this write up below! I am always trying to improve. Always learning is the way I roll.</p>","frontmatter":{"title":"Build a Dokku Server and Deploy a GraphQL Stack","date":null,"description":null,"image":{"publicURL":"/static/1c0ba5f429fd7e1883c8db2a702bbaef/maxresdefault.jpg","childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8e8a8","images":{"fallback":{"src":"/static/1c0ba5f429fd7e1883c8db2a702bbaef/4a49b/maxresdefault.jpg","srcSet":"/static/1c0ba5f429fd7e1883c8db2a702bbaef/b4dad/maxresdefault.jpg 320w,\n/static/1c0ba5f429fd7e1883c8db2a702bbaef/3440d/maxresdefault.jpg 640w,\n/static/1c0ba5f429fd7e1883c8db2a702bbaef/4a49b/maxresdefault.jpg 1280w","sizes":"(min-width: 1280px) 1280px, 100vw"},"sources":[{"srcSet":"/static/1c0ba5f429fd7e1883c8db2a702bbaef/c0bcc/maxresdefault.webp 320w,\n/static/1c0ba5f429fd7e1883c8db2a702bbaef/17574/maxresdefault.webp 640w,\n/static/1c0ba5f429fd7e1883c8db2a702bbaef/71d4d/maxresdefault.webp 1280w","type":"image/webp","sizes":"(min-width: 1280px) 1280px, 100vw"}]},"width":1280,"height":720}}}},"fields":{"date":"Tue Mar 05 2019 08:00:00 GMT+0800 (China Standard Time)","thumbnail":"49nn6we2IDo","slug":"build-a-dokku-server-and-deploy-a-graphql-stack/"}},"previous":{"fields":{"slug":"writing-poetry-for-friends/"},"frontmatter":{"title":"Writing Poetry for Friends"}},"next":{"fields":{"slug":"brackets-are-coming/"},"frontmatter":{"title":"Brackets are Coming"}}},"pageContext":{"id":"35d8b9a0-9af9-5b8a-8d6b-299e23476c10","previousPostId":"661f2fc0-75a5-5ddd-86a9-12e4591d4119","nextPostId":"fde1bd61-d232-5252-ac56-d8a224ad0cb8"}},
    "staticQueryHashes": ["1324386404","1767767760"]}